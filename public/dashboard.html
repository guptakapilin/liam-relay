<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Liam Control Panel</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 0;
    }
    header {
      background: #0c1f35;
      color: white;
      padding: 15px 30px;
      font-size: 1.5em;
    }
    .container {
      padding: 30px;
    }
    .card {
      background: white;
      padding: 20px;
      margin-bottom: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .card h2 {
      margin-top: 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table th, table td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      text-align: left;
    }
    button {
      padding: 10px 15px;
      background: #007BFF;
      border: none;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover {
      background: #0056b3;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1em;
    }
    .log-box {
      background: #000;
      color: #0f0;
      padding: 15px;
      font-family: monospace;
      height: 200px;
      overflow-y: scroll;
    }
  </style>
</head>
<body>

<header>Liam Unified Dashboard</header>

<div class="container">

  <!-- ðŸ“¤ Email Sender -->
  <div class="card">
    <h2>Send Email</h2>
    <input type="email" id="emailTo" placeholder="Recipient email">
    <select id="emailTemplate">
      <option value="email_template.txt">Default Template</option>
    </select>
    <input type="text" id="emailLink" placeholder="Drive link (optional)">
    <textarea id="emailBody" placeholder="Custom message body (optional override)"></textarea>
    <button onclick="sendEmail()">Send Email</button>
    <div id="emailStatus"></div>
  </div>

  <!-- ðŸ“¥ Upload Memory File -->
  <div class="card">
    <h2>Upload Memory File (JSON/ZIP)</h2>
    <input type="file" id="memoryFile">
    <button onclick="uploadMemory()">Upload</button>
    <div id="uploadStatus"></div>
  </div>

  <!-- ðŸ§  Unified Memory Viewer -->
  <div class="card">
    <h2>Agent Memory Files</h2>
    <div id="memoryTables"></div>
  </div>

  <!-- ðŸ” CLI Logs -->
  <div class="card">
    <h2>CLI Logs</h2>
    <button onclick="loadLogs()">Refresh Logs</button>
    <div class="log-box" id="cliLogs">Logs will appear here...</div>
  </div>

</div>

<script>
  async function sendEmail() {
    const to = document.getElementById('emailTo').value;
    const template = document.getElementById('emailTemplate').value;
    const link = document.getElementById('emailLink').value;
    const body = document.getElementById('emailBody').value;

    const params = new URLSearchParams({ to });
    if (link) params.append('link', link);
    if (template) params.append('template', template);
    if (body) params.append('body', body);

    const response = await fetch(`/send-email?${params.toString()}`);
    const status = await response.text();
    document.getElementById('emailStatus').innerText = status;
  }

  async function uploadMemory() {
    const fileInput = document.getElementById('memoryFile');
    if (!fileInput.files.length) return alert('Please select a file.');

    const formData = new FormData();
    formData.append('file', fileInput.files[0]);

    const response = await fetch('/upload-memory', { method: 'POST', body: formData });
    const data = await response.text();
    document.getElementById('uploadStatus').innerText = data;
  }

  async function loadMemories() {
    const res = await fetch('/list-memories');
    const json = await res.json();
    const { Liam = [], Eva = [], Radhika = [] } = json;

    const agents = { Liam, Eva, Radhika };
    let html = '';

    for (const [agent, files] of Object.entries(agents)) {
      html += `<h3>${agent}</h3><table><tr><th>Date</th><th>Name</th><th>Path</th><th>Status</th></tr>`;
      if (files.length === 0) {
        html += `<tr><td colspan="4">No files found</td></tr>`;
      } else {
        for (const file of files) {
          html += `<tr>
            <td>${new Date(file.modifiedTime).toLocaleString()}</td>
            <td>${file.name}</td>
            <td><a href="${file.webViewLink}" target="_blank">Open</a></td>
            <td>${file.status || 'â€”'}</td>
          </tr>`;
        }
      }
      html += `</table>`;
    }

    document.getElementById('memoryTables').innerHTML = html;
  }

  async function loadLogs() {
    const res = await fetch('/cli-log');
    const text = await res.text();
    document.getElementById('cliLogs').innerText = text || 'No logs yet.';
  }

  loadMemories();
</script>

</body>
</html>
